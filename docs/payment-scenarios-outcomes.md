# Payment Scenario Outcomes

The table below reframes the purchase scenarios as customer-facing outcomes so teams can quickly confirm the expected experience in each case.

**Mock identifiers**

- Catalog `c1` (Core Plans)
  - Product `p1` - non-stackable base plan. Prices: `pr1` = $10/month recurring, `pr2` = $50 one-time.
  - Product `p2` - non-stackable base plan. Price: `pr3` = $25/month recurring.
- Catalog `c2` (Starter Catalog)
  - Product `p3` - include-by-default base plan automatically granted, no direct purchase price.
  - Product `p4` - non-stackable upgrade. Price: `pr4` = $18/month recurring.
  - Product `p5` - non-stackable lifetime option. Price: `pr5` = $120 one-time.
- Catalog `c3` (Analytics Suite)
  - Product `p6` - non-stackable base plan that grants item bucket `i1`. Price: `pr6` = $30/month recurring.
  - Product `p7` - add-on tied to `p6`, stackable. Prices: `pr7` = $5/month recurring, `pr8` = $15 one-time.
  - Product `p9` - upgraded base plan for the same catalog. Price: `pr9` = $45/month recurring.
- Catalog `c4` (Operations Toolkit)
  - Product `p8` - server-only plan granted by admins. Prices: `pr10` = $0/month recurring, `pr11` = $0 one-time.
- Item bucket `i1` - analytics seats that are replenished by `p6`/`p9` and top-ups for `p7`.
- Adjustment entry `adj1` - manual ledger change used in support workflows.

| Customer state | Purchases recurring price | Purchases one-time price | Attempts duplicate of same product | Switches to different product in same catalog | Uses test-mode or direct API grant |
| --- | --- | --- | --- | --- | --- |
| **New customer with no active catalog entries** | Checking out with `pr1` (monthly for `p1` in catalog `c1`) completes successfully, starts billing, and unlocks everything tied to `p1` right away. | Buying `pr2` (one-time for `p1`) charges once and immediately delivers the lifetime benefits for `p1`. | If they try to run checkout for `pr1` or `pr2` again, the non-stackable rule for `p1` allows only the original grant and prevents duplicates. | Choosing `p2` instead (via `pr3`) works without conflicts because `c1` is empty, so the user just receives `p2` benefits. | Granting `p1` through an API or test workflow assigns it instantly even without checkout. |
| **New customer auto-enrolled in include-by-default product `p3` (catalog `c2`)** | Purchasing `pr4` for `p4` promotes them to the paid plan; during provisioning the system revokes `p3` so only `p4` remains active in `c2`. | If they instead buy `pr5` for `p5`, the flow removes `p3` once the payment clears and leaves `p5` as the sole active product in `c2`. | Trying to re-request `p3` or repurchase `p4` while it is active results in a message that the catalog already has that product assigned. | Switching between `p4` and `p5` always cancels the currently active `c2` product before activating the new one, preventing two base products from overlapping. | API/test grants for `p4` follow the same rule: the grant first drops `p3` (or any other `c2` product) before applying the new access. |
| **Customer already owns `p1`** | Checkout for `pr1` stops immediately with an already-subscribed message because `p1` is non-stackable. | Attempting to buy `pr2` again is blocked for the same reason, so the user keeps the original lifetime access without double billing. | If an admin tries to grant `p1` again through the API, the request is rejected and the single entitlement remains. | Trying to switch to `p1` again has no effect; the existing access persists until they move to another product. | Test-mode flows see that `p1` is already owned and return the same duplicate message. |
| **Customer owns `p2` in catalog `c1`** | Buying `pr1` for `p1` transitions them: the system ends `p2` and starts `p1` so only one core plan in `c1` stays active. | Purchasing `pr2` (one-time for `p1`) first cancels the active `p2` subscription, then grants the lifetime `p1` access so the catalog still shows a single product. | If someone tries to grant `p2` again via API while `p2` is active, the request is denied to preserve the single-plan rule. | Switching from `p2` to `p1` or back via checkout performs the cancellation-and-activate flow automatically so the user sees only the newly chosen plan. | Test-mode upgrades cleanly retire the simulated `p2` entry before granting `p1`, mirroring the live transition. |
| **Customer previously bought one-time product `p5` in catalog `c2`** | Attempting to buy `pr4` for `p4` is stopped with guidance to contact support because the user already has perpetual access through `p5`. | Trying to buy `pr5` again is declined with a message that `p5` is already owned. | API attempts to grant another copy of `p5` return the same duplicate warning so the catalog keeps a single lifetime record. | Switching from `p5` to `p4` or back requires an admin action that cancels the old product without issuing refunds, leaving only the newly requested one active. | Even in test-mode, the recorded `p5` grant blocks additional purchases until an admin removes it. |
| **Customer tries to buy add-on `p7` without base `p6`** | Checkout for recurring add-on price `pr7` stops with instructions to subscribe to `p6` first. | One-time top-up `pr8` is also prevented until `p6` is active, so no seats are delivered. | API grants of `p7` fail when `p6` is missing, keeping the catalog consistent. | Because `p7` never attaches, there is nothing to switch; base products in related catalogs stay untouched. | Test-mode requests for `pr7` or `pr8` surface the same prerequisite warning before any inventory changes. |
| **Customer receives server-only product `p8` via admin tools** | Admins can assign `pr10` for `p8` directly; the user gains the server-only features even though no checkout link exists. | Granting the one-time variant `pr11` posts immediately and lists the entitlement without exposing it in self-serve flows. | Attempting to grant `p8` again is declined so the internal product stays single-tenant. | Customers cannot swap `p8` themselves; admins remove `p8` before applying any replacement internal product. | Test-mode mirrors production by inserting `p8` through the same grant pipeline without needing Stripe. |
| **Customer balances item bucket `i1` with purchases and manual adjustments** | Each billing cycle of `pr6` (product `p6`) adds the scheduled number of `i1` seats, keeping the balance topped up. | They can purchase the add-on top-up `pr8` to immediately add a block of `i1` seats on top of the subscription balance. | Manual adjustments (entry `adj1`) respect the current `i1` balance and refuse changes that would push it negative unless admins allow it. | If they move from `p6` to `p9` (also in catalog `c3` with price `pr9`), the system rolls over remaining `i1` seats and starts replenishing according to the new plan. | Test-mode subscriptions for `pr6` adjust `i1` just like live billing, giving support a safe way to simulate balances. |
| **Invalid purchase attempts** | Submitting checkout for `pr1` with quantity 3 fails because `p1` is non-stackable, so the cart is stopped before billing. | Passing quantity 3 for `pr2` or referencing an unknown price such as `pr404` returns a clear error and no charge. | Grant requests that mismatch the customer type (for example assigning `p6` to a team-only account) are rejected immediately. | Since validation fails, no catalog switch is attempted; existing products like `p1` stay untouched. | Test-mode endpoints apply the same validations, so invalid inputs return errors without creating grants. |
